import{u as D}from"./list-ff8d1a46.js";import{g as F,o as R,a as G,n as q,u as d,b as L,r as O,w as H,c as A,s as P,d as z,e as $,f as J,h as C,i as k,V as K,j as h,k as V,t as E,l as x}from"./index-f6aab48d.js";import{V as U,a as Q}from"./VRow-ef407f17.js";function I(e){return F()?(R(e),!0):!1}function N(){const e=new Set,t=o=>{e.delete(o)};return{on:o=>{e.add(o);const r=()=>t(o);return I(r),{off:r}},off:t,trigger:(...o)=>Promise.all(Array.from(e).map(r=>r(...o)))}}function M(e){return typeof e=="function"?e():d(e)}const X=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Y=Object.prototype.toString,Z=e=>Y.call(e)==="[object Object]",ee=()=>{};function te(e){return e||L()}function ne(e,t=!0,n){const s=te(n);s?G(e,s):t?e():q(e)}function oe(e){var t;const n=M(e);return(t=n==null?void 0:n.$el)!=null?t:n}const j=X?window:void 0;function se(...e){let t,n,s,o;if(typeof e[0]=="string"||Array.isArray(e[0])?([n,s,o]=e,t=j):[t,n,s,o]=e,!t)return ee;Array.isArray(n)||(n=[n]),Array.isArray(s)||(s=[s]);const r=[],i=()=>{r.forEach(c=>c()),r.length=0},p=(c,l,u,a)=>(c.addEventListener(l,u,a),()=>c.removeEventListener(l,u,a)),S=H(()=>[oe(t),M(o)],([c,l])=>{if(i(),!c)return;const u=Z(l)?{...l}:l;r.push(...n.flatMap(a=>s.map(f=>p(c,a,f,u))))},{immediate:!0,flush:"post"}),m=()=>{S(),i()};return I(m),m}function re(){const e=O(!1);return L()&&G(()=>{e.value=!0}),e}function ie(e){const t=re();return A(()=>(t.value,!!e()))}function ae(e={}){const{window:t=j,requestPermissions:n=!0}=e,s=e,o=ie(()=>!!t&&"Notification"in t),r=O(o.value&&"permission"in Notification&&Notification.permission==="granted"),i=O(null),p=async()=>{if(o.value)return!r.value&&Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"&&(r.value=!0),r.value},{on:S,trigger:m}=N(),{on:c,trigger:l}=N(),{on:u,trigger:a}=N(),{on:f,trigger:y}=N(),T=async v=>{if(!o.value||!r.value)return;const g=Object.assign({},s,v);return i.value=new Notification(g.title||"",g),i.value.onclick=m,i.value.onshow=l,i.value.onerror=a,i.value.onclose=y,i.value},w=()=>{i.value&&i.value.close(),i.value=null};if(n&&ne(p),I(w),o.value&&t){const v=t.document;se(v,"visibilitychange",g=>{g.preventDefault(),v.visibilityState==="visible"&&w()})}return{isSupported:o,notification:i,ensurePermissions:p,permissionGranted:r,show:T,close:w,onClick:S,onShow:c,onError:u,onClose:f}}const fe={__name:"HomeView",setup(e){const t=D(),{currentItem:n,items:s,timeleft:o}=P(t),{setCurrentItem:r,countdown:i,setFinishedItem:p}=t,S=z(),{selectedAlarmFile:m,notify:c,colors:l,selectedColor:u}=P(S),a={STOP:0,COUNTING:1,PAUSE:2},f=O(a.STOP);let y=0;const T=()=>{f.value===a.STOP&&s.value.length>0&&r(),f.value=a.COUNTING,y=setInterval(()=>{i(),o.value===0&&v()},1e3)},w=()=>{f.value=a.PAUSE,clearInterval(y)},v=()=>{clearInterval(y),f.value=a.STOP;const b=new Audio;if(b.src=m.value,b.play(),c.value){const{show:_,isSupported:B}=ae({title:"事項完成",body:n.value,icon:new URL(""+new URL("tomato-fe6b03eb.png",import.meta.url).href,self.location).href});B.value&&_()}p(),s.value.length>0&&T()},g=A(()=>n.value.length>0?n.value:s.value.length>0?"點擊開始":"沒有事項"),W=A(()=>{const b=Math.floor(o.value/60).toString().padStart(2,"0"),_=(o.value%60).toString().padStart(2,"0");return b+":"+_});return(b,_)=>($(),J(K,{class:k(d(l)[d(u)-1].name)},{default:C(()=>[h(Q,null,{default:C(()=>[h(U,{cols:"12"},{default:C(()=>[V("h1",{class:k(["text-center text-h2 font-weight-bold pa-6",d(l)[d(u)-1].name])},E(g.value),3),V("h1",{class:k(["text-center",d(l)[d(u)-1].name])},E(W.value),3)]),_:1}),h(U,{cols:"12",class:"text-center"},{default:C(()=>[h(x,{variant:"text",icon:"mdi-play",disabled:f.value===a.COUNTING||d(n).length===0&&d(s).length===0,onClick:T},null,8,["disabled"]),h(x,{variant:"text",icon:"mdi-pause",disabled:f.value!==a.COUNTING,onClick:w},null,8,["disabled"]),h(x,{variant:"text",icon:"mdi-skip-next",disabled:d(n).length===0,onClick:v},null,8,["disabled"])]),_:1})]),_:1})]),_:1},8,["class"]))}};export{fe as default};
